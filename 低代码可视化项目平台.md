# 一、版本信息

- **软件版本：**
- **撰写时间：**
- **撰写人：**
- **操作系统：**

---

# 二、产品定位

旨在打造一种创新的开发工具，通过直观的可视化界面、预构建的组件和强大的集成能力，降低软件开发门槛。

**项目原动力：**  
1. **与时俱进的工具型产品：**  
   在当今快速迭代的软件开发环境中，企业对开发效率与敏捷性的追求愈发迫切，响应市场变化和业务需求，提供一个数字化转型工具。  
2. **挖掘人的价值和潜力：**  
   搭建一个低门槛的开发平台，使得即便是非专业开发人员也能轻松参与到应用的创建与迭代中来。

---

# 三、功能说明

## 3.1 功能摘要说明

本版本主要实现「可视化大屏搭建」的核心能力，目标是让业务人员在无需编写代码的情况下完成数据连接、图表配置与可视化页面搭建。功能范围如下：

1. **可视化搭建器（页面编辑）**  
   - 提供所见即所得的编辑器  
   - 支持组件拖拽、删除、复制、对齐、分组等基础操作  
   - 支持网格布局系统：吸附、自动对齐与比例缩放  
   - 交互逻辑可配置：组件间点击跳转、筛选联动、数据联动事件  

2. **多数据源接入**  
   - 支持 **MySQL / PostgreSQL / API / CSV / Excel**  
   - 提供数据预览、字段映射、语句编辑校验与定时刷新  
   - 数据拉取方式：**实时查询 / 定时缓存**  
   - 支持在 PRD 中定义实时 SLA（如 ≤2s）

3. **图表组件库**  
   - 折线图、柱状图、饼图、地图、KPI 卡片  
   - 支持自定义主题、配色、动画、数据绑定  
   - 支持筛选、联动、下钻、tooltip 配置  

4. **部署与权限管理**  
   - 支持 **私有云 / 公有云 / 本地部署**  
   - 支持页面访问权限、编辑权限、数据权限控制  
   - 支持生成分享链接或 iframe 嵌入  

5. **非目标**  
   - 不支持自定义脚本拓展  
   - 不支持多语言版本  
   - 不支持组件市场  
   - 不支持多人实时协同编辑  

---

# 四、主要业务、交互流程

## 4.1 角色与使用场景

### （1）核心使用角色（较低开发能力）

- 业务人员 / 数据分析人员  
- 运营 / 管理层  

### （2）典型使用场景

1. 业务人员将分散的数据源接入平台  
2. 通过拖拽组件完成可视化页面搭建  
3. 配置图表与数据的绑定关系  
4. 生成大屏并发布给管理层查看  

---

## 4.2 核心业务流程总览

> 完成可视化页面 → 配置数据源 → 数据字段映射与校验 →  
> 拖拽组件并绑定数据 → 配置图表样式与交互 →  
> 预览与调试 → 发布并配置权限 → 用户访问与数据刷新

---

## 4.3 详细业务流程拆解

### 4.3.1 页面创建流程

- **用户操作：**  
  进入可视化搭建器 → 点击创建页面 → 填写名称与描述 → 选择画布尺寸（1920×1080 / 自定义） → 选择基础模板或空白页面  
- **系统逻辑：**  
  校验名称唯一性 → 初始化画布配置（grid、缩放比例、空组件状态） → 生成页面 ID → 进入编辑态  

---

### 4.3.2 数据源配置流程

- **用户操作：**  
  选择数据源类型（MySQL / API / Excel / CSV / TXT / Word） → 填写连接信息 → 测试连接 → 保存  
- **系统逻辑：**  
  参数校验 → 发起真实连接测试 → 记录数据源状态 → 存储为复用配置  

---

### 4.3.3 数据源与字段映射流程

- **用户操作：**  
  选择数据源 → 填写 SQL/API → 预览字段 → 设置类型、别名、单位、精度 → 保存为数据集  
- **系统逻辑：**  
  校验 SQL/API → 返回样本数据 → 建立字段映射关系  

---

### 4.3.4 组件拖拽与布局流程

- **用户操作：**  
  拖拽组件至画布 → 调整位置与大小  
- **系统逻辑：**  
  根据 Grid 计算坐标 → 更新 layout schema → 处理遮挡与层级  

---

### 4.3.5 数据绑定与图表配置流程

- **用户操作：**  
  绑定数据集 → 设置维度与聚合方式 → 配置样式 → 保存  
- **系统逻辑：**  
  解析规则 → 生成渲染 schema → 实时刷新  

---

### 4.3.6 组件联动与交互配置流程

- **用户操作：**  
  选择触发组件 → 配置筛选或跳转 → 指定被影响组件  
- **系统逻辑：**  
  建立事件映射 → 运行态触发刷新  

---

### 4.3.7 预览与调试流程

- **用户操作：**  
  点击预览 → 验证数据与刷新模式 → 查看异常日志  
- **系统逻辑：**  
  执行完整数据拉取 → 记录异常与耗时  

---

### 4.3.8 发布与权限配置流程

- **用户操作：**  
  发布页面 → 配置查看/编辑/评论权限 → 选择部署方式 → 生成访问链接  
- **系统逻辑：**  
  冻结版本 → 生成发布 ID → 返回访问地址  

---

### 4.3.9 浏览与数据刷新流程（查看端）

- **查看用户操作：**  
  打开链接 → 只读模式查看实时数据  
- **系统逻辑：**  
  校验权限 → 按实时或定时策略刷新 → 渲染图表  

---

## 4.4 异常与容错处理

- 数据源连接失败 → 页面提示 + 日志记录  
- 查询超时（>SLA） → 返回缓存或兜底提示  
- 字段缺失 / 类型不匹配 → 禁止发布并标红  
- 权限不足 → 禁止访问  

---

## 4.5 本版本流程边界说明

- 仅支持单人编辑  
- 不支持冲突处理  
- 不支持动态脚本执行  
- 不支持第三方组件市场  

---

# 五、功能需求

## 5.4 后端

### 【需求说明】

旨在通过可视化流程节点，让业务人员无需编程即可完成业务逻辑设计与数据处理。

### 【交互说明】

拖拽式流程节点支持：

1. 数据处理  
2. 条件判断与循环  
3. 外部 API 调用  
4. 数据表增删改查  
5. 自定义触发器  

---

### 【可视化节点编排说明】

#### 6. 触发器

- 前端事件触发：按钮提交、表单提交、组件交互  
- 定时触发：秒 / 分 / 时 / 日  
- 数据表事件触发：新增、修改、删除（支持过滤条件）

#### 7. 流程节点

- 条件判断（if-else）  
- 循环节点（for / foreach / while）

#### 8. 数据表操作节点

- CREATE / UPDATE / SELECT / DELETE  
- 支持 WHERE / JOIN / LIMIT / ORDER / HAVING  

#### 9. 外部 API 调用节点

- REST  
- 内部服务调用  
- Header / Query / Body 配置  
- JSON Path 提取  

#### 10. 数据转换节点

- 字段映射  
- JSON 解析 / 序列化  
- 数据类型转换  

---

### 【数据结构与参数校验说明】

11. 每个节点必须定义：

- 输入参数  
- 输出参数  
- 数据类型校验  
- 必填校验  
- 字段映射关系  

---

### 【流程执行与调试说明】

12. 流程链路图  
13. sbs debug  
14. 节点输入输出快照  
15. 错误节点高亮  

---

### 【权限与安全说明】

16. 数据表权限限制  
17. 权限变更自动同步  
18. 外部 API Token 配置  
19. 敏感字段自动脱敏  

---

# 六、改进意见

1. 没有嵌套循环 + 条件判断  
2. 没有多分支流程  
3. 复杂聚合函数（GROUP BY）  
4. 状态机逻辑  
